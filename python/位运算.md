Python 位运算快览

### 运算符

- **与（AND）**: `a & b`
- **或（OR）**: `a | b`
- **异或（XOR）**: `a ^ b`
- **非（NOT）**: `~a`
- **左移**: `a << n`
- **右移**: `a >> n`

### 特点

- 操作数位数不同时，较短者高位补 0。
- Python 整数无固定位长，支持超出常规 32/64 位的操作。
- 对有符号数进行移位时，右移进行算术移位（保留符号位）。

### 示例

```python
# 简单示例
a, b = 8, 2
res_and = a & b      # AND 结果
res_or = a | b       # OR 结果
res_xor = a ^ b      # XOR 结果
res_not = ~a         # NOT 结果
res_lshift = a << 2  # 左移 2 位
res_rshift = a >> 2  # 右移 2 位
```

这是一个直接而精准的概述，涵盖了核心要点和使用方法。

位运算相关操作


位运算在编程中是一种非常强大和高效的工具，尤其是在处理二进制数据、优化性能或进行低层次的编程时。以下是一些常用的位运算技巧及其应用：

### 1. 设置位

要将数字 `n` 的第 `i` 位设置为 `1`，可以使用按位或操作 `|`：

```python
n |= (1 << i)
```

这里 `1 << i` 表示将 `1` 左移 `i` 位，然后通过 `|` 与 `n` 结合。

### 2. 清除位

要将数字 `n` 的第 `i` 位设置为 `0`：

```python
n &= ~(1 << i)
```

`~(1 << i)` 会在第 `i` 位产生 `0`，其他位都是 `1`。与 `n` 进行按位与操作将第 `i` 位清零。

### 3. 切换位

要切换（toggle）数字 `n` 的第 `i` 位（即 `1` 变 `0`，`0` 变 `1`）：

```python
n ^= (1 << i)
```

这里 `^` 是按位异或操作。

### 4. 检查位

要检查数字 `n` 的第 `i` 位是否为 `1`：

```python
bit = (n >> i) & 1
```

这里通过 `>>` 右移将第 `i` 位移至最低位，然后与 `1` 进行按位与操作。

### 5. 清除最低位的 `1`

要清除 `n` 的最低位（最右边）的 `1`：

```python
n &= n - 1
```

这个操作在计算一个数的二进制表示中 `1` 的个数时非常有用。

### 6. 清除最低位的 `0`

要清除 `n` 的最低位（最右边）的 `0`：

```python
n |= n + 1
```

这个操作用于将最低位的 `0` 变为 `1`。

### 7. 提取最低位的 `1`

要获取 `n` 中最低位的 `1`：

```python
low_bit = n & -n
```

这里 `-n` 是 `n` 的二进制补码。

### 8. 求两数异或

异或操作 `^` 可以用来找出两个数字不同的位：

```python
diff = n ^ m
```

这在计算汉明距离等问题中非常有用。

### 9. 求模运算的位运算替代

对于 `2` 的幂次方的模运算，可以使用位运算来替代：

```python
mod = n & (divisor - 1)
```

这里 `divisor` 必须是 `2` 的幂。

### 10. 获取无符号整数中的最高位 `1`

可以使用一种名为“二分掩码”的技术来找到无符号整数最高位的 `1`：

```python
def highestOneBit(n):
    n |= (n >> 1)
    n |= (n >> 2)
    n |= (n >> 4)
    n |= (n >> 8)
    n |= (n >> 16)  # 对于32位整数，如果是64位，还需要n |= (n >> 32)
    return n - (n >> 1)

# 测试
print(highestOneBit(18))  # 输出16，因为18的二进制为10010，最高位的1是在16的位置
```

### 11. 数字范围内的位计数

计算从 `0` 到 `n` 每个数的二进制表示中 `1` 的个数：

```python
def countBits(n):
    ans = [0] * (n + 1)
    for i in range(1, n + 1):
        ans[i] = ans[i & (i - 1)] + 1
    return ans

# 测试
print(countBits(5))  # 输出[0, 1, 1, 2, 1, 2]
```

### 12. 检查数字是否为2的幂

使用位运算来快速检查一个整数是否是2的幂：

```python
def isPowerOfTwo(n):
    return n > 0 and (n & (n - 1)) == 0

# 测试
print(isPowerOfTwo(16))  # 输出True
print(isPowerOfTwo(18))  # 输出False
```

### 13. 对齐到最近的2的幂

增加数字直到它是2的幂：

```python
def alignPowerOfTwo(n):
    n -= 1
    n |= n >> 1
    n |= n >> 2
    n |= n >> 4
    n |= n >> 8
    n |= n >> 16  # 对于32位整数，如果是64位，还需要n |= (n >> 32)
    return n + 1

# 测试
print(alignPowerOfTwo(17))  # 输出32
```

### 14. 反转二进制位

反转一个整数的二进制位：

```python
def reverseBits(n):
    result = 0
    for i in range(32):  # 假设是32位整数
        result = (result << 1) | (n & 1)
        n >>= 1
    return result

# 测试
print(reverseBits(43261596))  # 输出964176192
```

### 15. 循环位移

对整数进行循环左移或右移：

```python
def rotateLeft(n, d, bits=32):
    return ((n << d) | (n >> (bits - d))) & ((1 << bits) - 1)

def rotateRight(n, d, bits=32):
    return ((n >> d) | (n << (bits - d))) & ((1 << bits) - 1)

# 测试
print(rotateLeft(16, 2))  # 对16进行左循环移2位
print(rotateRight(16, 2)) # 对16进行右循环移2位
```
